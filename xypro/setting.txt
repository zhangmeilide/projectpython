    # Docker Compose é…ç½®æ–‡ä»¶ï¼Œç”¨äºéƒ¨ç½² FastAPI åº”ç”¨
    # æ­¤æ–‡ä»¶å®šä¹‰äº† Docker æœåŠ¡çš„é…ç½®ï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„é•œåƒã€ç«¯å£æ˜ å°„ã€æŒ‚è½½å·ç­‰ä¿¡æ¯

    # æŒ‡å®š Docker Compose æ–‡ä»¶çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œä½¿ç”¨ 3.8 ç‰ˆæœ¬
    docker-compose.yml 
    version: '3.8'

# å®šä¹‰ Docker æœåŠ¡çš„éƒ¨åˆ†
    services:
    # å®šä¹‰ä¸€ä¸ªåä¸º fastapi çš„æœåŠ¡
    fastapi:
        # æŒ‡å®šè¯¥æœåŠ¡ä½¿ç”¨çš„ Docker é•œåƒï¼Œè¿™é‡Œä½¿ç”¨åä¸º my-fastapi-app çš„é•œåƒ
        image: my-fastapi-app
        # ä¸ºè¯¥æœåŠ¡çš„å®¹å™¨æŒ‡å®šä¸€ä¸ªåç§°ï¼Œæ–¹ä¾¿åç»­ç®¡ç†å’Œè¯†åˆ«
        container_name: fastapi_app
        # å®šä¹‰ç«¯å£æ˜ å°„ï¼Œå°†å®¹å™¨å†…éƒ¨çš„ 8083 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ 8083 ç«¯å£
        # å¤–éƒ¨å¯ä»¥é€šè¿‡å®¿ä¸»æœºçš„ 8083 ç«¯å£è®¿é—®å®¹å™¨å†…çš„ FastAPI åº”ç”¨
        # å¤–éƒ¨æ¥å£è®¿é—®åœ°å€ï¼šhttp://10.180.138.37:8083
        ports:
        - "8083:8083"
        # å®šä¹‰å®¹å™¨å¯åŠ¨æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤
        # è¿™é‡Œä½¿ç”¨ uvicorn å¯åŠ¨ FastAPI åº”ç”¨ï¼ŒæŒ‡å®šä¸»åº”ç”¨æ–‡ä»¶ä¸º main.pyï¼Œåº”ç”¨å®ä¾‹ä¸º app
        # ç›‘å¬æ‰€æœ‰å¯ç”¨çš„ç½‘ç»œæ¥å£ï¼Œç«¯å£ä¸º 8083
        command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8083"]
        # å®šä¹‰æ•°æ®å·æŒ‚è½½ï¼Œå°†å®¿ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„ app æ–‡ä»¶å¤¹æŒ‚è½½åˆ°å®¹å™¨å†…çš„ /app ç›®å½•
        # è¿™æ ·å¯ä»¥å®ç°å®¿ä¸»æœºå’Œå®¹å™¨ä¹‹é—´çš„æ–‡ä»¶å…±äº«
        volumes:
        - ./app:/app
        # å®šä¹‰å®¹å™¨çš„é‡å¯ç­–ç•¥ï¼Œè®¾ç½®ä¸º always è¡¨ç¤ºå®¹å™¨æ— è®ºå› ä¸ºä»€ä¹ˆåŸå› åœæ­¢éƒ½ä¼šè‡ªåŠ¨é‡å¯
        restart: always

-------------------------------------------------------------------------------------------

ä¸‹é¢æ˜¯å®Œæ•´çš„æ–‡å­—ï¼š 

    version: '3.8'                                                                                                                                                                                                     
    services:
    fastapi:
        image: my-fastapi-app
        container_name: fastapi_app
        ports:
        - "8083:8083"
        command: ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8083"]
        volumes:
        - ./app:/app
        restart: always



---------------------------------------------------------------------------------------------------------------

 ç¦»çº¿æ„å»ºéƒ¨ç½² Docker é•œåƒæµç¨‹ ï¼Œè‡ªåŠ¨åŒ–è„šæœ¬ï¼špackage-and-transfer.sh

 #!/bin/bash

set -e

# ======= é…ç½®åŒºåŸŸï¼ˆæ ¹æ®ä½ çš„å®é™…æƒ…å†µä¿®æ”¹ï¼‰=======
    APP_NAME="my-fastapi-app"
    IMAGE_TAG="latest"
    IMAGE_FILE="${APP_NAME}.tar"
    CODE_DIR="/home/user/my-fastapi-app"  # é¡¹ç›®è·¯å¾„
    CODE_ARCHIVE="${APP_NAME}.tar.gz"
    REMOTE_HOST="root@10.180.138.37"
    REMOTE_DIR="/root"
    # ===============================================

    echo "ğŸš€ [1/5] æ„å»º Docker é•œåƒ..."
    cd "$CODE_DIR"
    docker build -t $APP_NAME:$IMAGE_TAG .

    echo "ğŸ“¦ [2/5] å¯¼å‡º Docker é•œåƒä¸º $IMAGE_FILE..."
    docker save $APP_NAME:$IMAGE_TAG -o "$IMAGE_FILE"

    echo "ğŸ—ƒ [3/5] æ‰“åŒ…é¡¹ç›®ç›®å½•ä¸º $CODE_ARCHIVE..."
    cd "$(dirname "$CODE_DIR")"
    tar czf "$CODE_ARCHIVE" "$(basename "$CODE_DIR")"

    echo "ğŸ“¡ [4/5] ä¼ è¾“æ–‡ä»¶åˆ°è¿œç¨‹æœåŠ¡å™¨: $REMOTE_HOST"
    scp "$IMAGE_FILE" "$CODE_ARCHIVE" "$REMOTE_HOST:$REMOTE_DIR"

    echo "âœ… [5/5] å®Œæˆï¼ä½ å¯ä»¥åœ¨ç›®æ ‡æœåŠ¡å™¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š"
    echo "--------------------------------------------"
    echo "cd $REMOTE_DIR"
    echo "docker load -i $IMAGE_FILE"
    echo "tar xzf $CODE_ARCHIVE"
    echo "cd $(basename "$CODE_DIR")"
    echo "docker run -d --name $APP_NAME -p 8000:8000 $APP_NAME:$IMAGE_TAG"
    echo "--------------------------------------------"

-------------------------------------------------------------------------------
æµç¨‹ï¼š

æ­¥éª¤ | æ“ä½œä½ç½® | è¯´æ˜
æ„å»ºé•œåƒ | å¼€å‘æœº | docker build
å¯¼å‡ºé•œåƒ | å¼€å‘æœº | docker save
ä¼ è¾“é•œåƒ | Uç›˜ / scp | scp / copy
åŠ è½½é•œåƒ | æœåŠ¡å™¨ | docker load
å¯åŠ¨æœåŠ¡ | æœåŠ¡å™¨ | docker run


-------------------------------------------------------------------------------
å…·ä½“æµç¨‹ï¼š

ä¸€ã€å‡†å¤‡å·¥ä½œ
    1.1 æ„å»ºç¯å¢ƒè¦æ±‚ï¼ˆå¼€å‘æœºï¼‰
        èƒ½è®¿é—®äº’è”ç½‘
        å·²å®‰è£… Docker
        å­˜æ”¾ FastAPI é¡¹ç›®çš„ç›®å½•ï¼ˆæ¯”å¦‚ /home/user/my-fastapi-appï¼‰
    1.2 ç›®æ ‡ç¯å¢ƒè¦æ±‚ï¼ˆç›®æ ‡æœåŠ¡å™¨ï¼‰
        å·²å®‰è£… Docker
        å¯é€šè¿‡ç‰©ç†æ–¹å¼ï¼ˆUç›˜ã€scpï¼‰æ¥æ”¶æ–‡ä»¶
        æ— æ³•è”ç½‘æˆ–å—é™è”ç½‘

äºŒã€åœ¨å¼€å‘æœºä¸Šæ„å»ºé•œåƒå¹¶å¯¼å‡º
    2.1 ç¼–å†™ Dockerfileï¼ˆä½äºé¡¹ç›®æ ¹ç›®å½•ï¼‰
        # Dockerfile

        FROM bitnami/python:3.10.16-debian-12-r0
        WORKDIR /app
        COPY requirements.txt ./
        RUN pip install --no-cache-dir -r requirements.txt
        COPY . .
        EXPOSE 8000
        CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
        æ³¨æ„ï¼šå¦‚æœä½ çš„é¡¹ç›®ä¸­æœ‰ .dockerignoreï¼Œç¡®è®¤å®ƒæ’é™¤æ— å…³æ–‡ä»¶ã€‚

    2.2 æ„å»ºé•œåƒ
        cd /home/user/my-fastapi-app
        docker build -t my-fastapi-app:latest .

    2.3 å¯¼å‡ºé•œåƒä¸º .tar æ–‡ä»¶
        docker save my-fastapi-app:latest -o /home/user/fastapi.tar

ä¸‰ã€å°†é•œåƒå’Œé¡¹ç›®ä¼ è¾“åˆ°ç›®æ ‡æœåŠ¡å™¨
    ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€ï¼š
    æ–¹å¼ 1ï¼šä½¿ç”¨ scp
        scp /home/user/fastapi.tar root@<ç›®æ ‡æœåŠ¡å™¨IP>:/root/
    æ–¹å¼ 2ï¼šU ç›˜ / ç½‘ç»œå…±äº«
        å°† fastapi.tar æ‹·è´è‡³ç›®æ ‡æœåŠ¡å™¨ï¼Œå¦‚ /root/

å››ã€åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸ŠåŠ è½½é•œåƒå¹¶è¿è¡Œå®¹å™¨
    4.1 åŠ è½½é•œåƒ
    docker load -i /root/fastapi.tar
    4.2 è¿è¡Œå®¹å™¨
    docker run -d --name fastapi-app -p 8000:8000 my-fastapi-app:latest

    å¦‚æœä½ çš„æœåŠ¡éœ€è¦ç»‘å®šåˆ°ç‰¹å®š IP æˆ–æŒ‚è½½æ•°æ®å·ï¼Œè¯·æŒ‰éœ€åŠ å‚æ•°ã€‚
